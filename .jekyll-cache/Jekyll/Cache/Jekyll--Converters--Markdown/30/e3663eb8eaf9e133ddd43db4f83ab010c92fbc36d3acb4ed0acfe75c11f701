I"+<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">모이고 푸시 스로틀링을 통한 TOPIC_RATE_EXCEEDED 에러 방지</span>
</code></pre></div></div>

<p>참고 링크
<strong>https://firebase.google.com/docs/cloud-messaging/concept-options#fanout_throttling</strong>
<strong>https://firebase.google.com/docs/cloud-messaging/send-message?hl=ko#admin</strong></p>

<p>모이고 기능 개발도중 FCM에 TOPIC RATE EXCEEDED 에러가 발생했다.</p>

<p>해당 에러는 <strong>특정 주제의 구독자에게 전달되는 메시지 비율이 너무 높습니다. 이 주제로 보내는 메시지 수를 줄이세요. 바로 다시 보내도록 시도해서는 안 됩니다.</strong> 의 이유로 발생한다.</p>

<p>FCM의 클라이언트 수신 가능한 최대 개수가 분당 240개. 시간당 5000개까지 제한하고 있다. 
분당 240개를 잡고 계산했을 때, 0.25초당 1개의 푸시만 클라이언트에 전송되어야 한다.
물론, 더 적게 보내게끔 추후 개선해야 한다.</p>

<p>따라서, 최근에 해당 부분에 대해서 작업하여, 0.25초마다 한번씩만 푸시를 하도록 하였다.
여러개의 푸시가 한번에 몰려도 토픽당 1초에 최대 4번까지만 전송한다는 이야기다.</p>

<p>각 토픽마다 gen_server를 global로 띄운후에, 요청 function 을 호출하면, 띄워진 토픽에 해당하는 gen_server로 푸시요청이 넘겨지고, 매 0.25초 마다 한번씩 해당 푸시를 전송하도록 하였다.</p>
:ET